(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{"9oVN":function(t,n,e){"use strict";e.d(n,"l",(function(){return r})),e.d(n,"p",(function(){return l})),e.d(n,"h",(function(){return a})),e.d(n,"g",(function(){return c})),e.d(n,"j",(function(){return u})),e.d(n,"d",(function(){return h})),e.d(n,"b",(function(){return f})),e.d(n,"o",(function(){return m})),e.d(n,"i",(function(){return d})),e.d(n,"n",(function(){return y})),e.d(n,"c",(function(){return b})),e.d(n,"e",(function(){return p})),e.d(n,"k",(function(){return g})),e.d(n,"m",(function(){return _})),e.d(n,"f",(function(){return v})),e.d(n,"a",(function(){return S}));var o=e("G4qV"),r=function(t){return t.symbolLists.lists},s=function(t){return t.widgets},i=function(t,n){return n},l=Object(o.a)([s,i],(function(t,n){return t[n]||{}})),a=Object(o.a)(l,(function(t){return t.selectedSymbols||[]})),c=Object(o.a)(l,(function(t){return t.scrollToId})),u=Object(o.a)(l,(function(t){return t.sorting||null})),h=Object(o.a)(l,(function(t){return t.highlightedSymbols||null})),f=Object(o.a)(l,(function(t){return t.columns})),m=Object(o.a)(l,(function(t){return t.options||{}})),d=Object(o.a)([m,function(t){return t.isAuthenticated}],(function(t,n){return t.shouldDisplayPositions&&n})),y=Object(o.a)(r,(function(t){return Object.values(t).filter((function(t){return void 0!==t&&!t.isHotlist}))})),b=Object(o.a)([r,s,i],(function(t,n,e){var o=n[e];if(void 0===o)return null;var r=o.listId;return null===r?null:t[r]||null})),p=Object(o.a)([l,b],(function(t,n){return null===n||t.isLoading||!1})),g=Object(o.a)([r,function(t,n){return n}],(function(t,n){return t[n]})),_=Object(o.a)(b,(function(t){return null!==t?t.symbols:[]})),v=Object(o.a)([function(t){return t.positions},function(t,n){return n}],(function(t,n){return t[n]})),S=function(t){return t.activeSymbolList}},G4qV:function(t,n,e){"use strict";function o(t,n){return t===n}function r(t,n,e){if(null===n||null===e||n.length!==e.length)return!1;for(var o=n.length,r=0;r<o;r++)if(!t(n[r],e[r]))return!1;return!0}function s(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,e=null,s=null;return function(){return r(n,e,arguments)||(s=t.apply(null,arguments)),e=arguments,s}}function i(t){var n=Array.isArray(t[0])?t[0]:t;if(!n.every((function(t){return"function"==typeof t}))){var e=n.map((function(t){return typeof t})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+e+"]")}return n}e.d(n,"b",(function(){return s})),e.d(n,"a",(function(){return l}));var l=function(t){for(var n=arguments.length,e=Array(n>1?n-1:0),o=1;o<n;o++)e[o-1]=arguments[o];return function(){for(var n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];var s=0,l=o.pop(),a=i(o),c=t.apply(void 0,[function(){return s++,l.apply(null,arguments)}].concat(e)),u=t((function(){for(var t=[],n=a.length,e=0;e<n;e++)t.push(a[e].apply(null,arguments));return c.apply(null,t)}));return u.resultFunc=l,u.dependencies=a,u.recomputations=function(){return s},
u.resetRecomputations=function(){return s=0},u}}(s)},"p+vD":function(t,n,e){"use strict";e.r(n),e.d(n,"getAllWatchLists",(function(){return c})),e.d(n,"getColoredWatchLists",(function(){return u})),e.d(n,"getCustomWatchLists",(function(){return h})),e.d(n,"getSymbols",(function(){return f})),e.d(n,"renameWatchList",(function(){return m})),e.d(n,"removeWatchList",(function(){return d})),e.d(n,"addSymbols",(function(){return y})),e.d(n,"removeSymbols",(function(){return b})),e.d(n,"replaceSymbols",(function(){return p})),e.d(n,"createWatchList",(function(){return g})),e.d(n,"putWatchList",(function(){return _})),e.d(n,"exportList",(function(){return v})),e.d(n,"setActive",(function(){return S})),e.d(n,"getActive",(function(){return C}));var o=e("mrSG"),r=e("Eyy1"),s=e("BHQF"),i=e("AXL+");function l(t){var n=Object(o.__assign)({},t);return n.title=n.name,delete n.name,Object(o.__assign)(Object(o.__assign)({},n),{id:"colored"===n.type?Object(r.ensureNotNull)(n.color):n.id,isHotlist:!1})}function a(t){return t.ok?t.json():t.json().then((function(t){throw new Error(t.detail||"not ok")}))}function c(){return Object(s.fetch)("/api/v1/symbols_list/all/",{credentials:"include"}).then(a).then((function(t){return t.filter((function(t){return t.symbols.length>0}))})).then((function(t){return t.map(l)}))}function u(){return Object(s.fetch)("/api/v1/symbols_list/colored/",{credentials:"same-origin"}).then(a).then((function(t){return t.map(l)}))}function h(){return Object(s.fetch)("/api/v1/symbols_list/custom/",{credentials:"same-origin"}).then(a).then((function(t){return t.map(l)}))}function f(t){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/",{credentials:"same-origin"}).then(a)}function m(t,n){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/rename/",{method:"POST",credentials:"same-origin",body:JSON.stringify({name:n}),headers:{"Content-Type":"application/json"}}).then(a)}function d(t){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/",{method:"DELETE",credentials:"same-origin"})}function y(t,n){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/append/",{method:"POST",credentials:"same-origin",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(a)}function b(t,n){return Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/remove/",{method:"POST",credentials:"same-origin",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(a)}function p(t,n){return 0===n.length&&"colored"===t.type?d(t):Object(s.fetch)("/api/v1/symbols_list/"+t.type+"/"+t.id+"/replace/?unsafe=true",{method:"POST",credentials:"same-origin",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(a)}function g(t){var n=Object(o.__assign)(Object(o.__assign)({},t),{name:t.title});return delete n.title,Object(s.fetch)("/api/v1/symbols_list/custom/",{method:"POST",credentials:"same-origin",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(a).then(l)}function _(t){throw new Error("not implemented")}function v(t){
Object(i.saveTextFile)(t.title+".txt",t.symbols.join(","))}function S(t){return Object(s.fetch)("/api/v1/symbols_list/active/"+t+"/",{method:"POST",credentials:"same-origin"})}function C(){return Object(s.fetch)("/api/v1/symbols_list/active/",{method:"GET",credentials:"same-origin"}).then(a).then(l)}},tEuG:function(t,n,e){"use strict";e("bSeV");var o,r=e("YFKU"),s=e("mrSG"),i=e("Eyy1"),l=e("BHQF"),a=e("p+vD"),c=e("txPx"),u=Object(c.getLogger)("MarkedSymbols.Api"),h=function(){function t(){}return t.prototype.getColoredLists=function(){return Object(a.getColoredWatchLists)()},t.prototype.removeSymbols=function(t,n){return 0===n.length?Promise.resolve():(u.logNormal("Sending request to remove symbols from "+t+"-list: "+n),Object(l.fetch)("/api/v1/symbols_list/colored/"+t+"/remove/",{method:"POST",credentials:"same-origin",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}))},t.prototype.addSymbols=function(t,n){return 0===n.length?Promise.resolve():(u.logNormal("Sending request to add/move symbols to "+t+"-list: "+n),Object(l.fetch)("/api/v1/symbols_list/colored/"+t+"/append/",{method:"POST",credentials:"same-origin",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}))},t}(),f=e("FBuY"),m=e("TxTq"),d=e.n(m),y=e("PfBM"),b=e("dm8g"),p=(e("NNtz"),e("J/x9")),g=e("9oVN"),_=e("ehHn"),v=e("IWXC"),S=Object(c.getLogger)("MarkedSymbols.Model"),C=["red","blue","green","orange","purple"],O=null,j=function(){function t(t){var n=this;this._promise=Object(p.a)(),this._service=null,this._symbols=new Map,this._changed=new Set,this._diff=new Map,this._names={},this._onCrossTabChange=function(t){S.logNormal("Cross tab sync"),JSON.parse(t).forEach((function(t){n._setSymbolColor(t.name,t.color)})),n._onListChange(!0)},this._onPushStreamChange=function(t){window.user&&window.user.session_hash!==t&&(S.logNormal("Cross browser sync"),n.syncSymbols())},this._onPushStreamStatus=function(t){t===y.ConnectionStatus.Open&&O===y.ConnectionStatus.Closed?(window.is_authenticated&&(o=setTimeout((function(){S.logNormal("Reconnect sync"),n.syncSymbols()}),30*Math.random()*1e3+3e4)),O=t):t===y.ConnectionStatus.Closed&&(O=t,clearTimeout(o))},this._opts=t,this._api=t.api||new h,this._session=t.quoteSession||Object(v.getQuoteSessionInstance)("simple"),this._promise.then((function(t){return n._service=t})),this.connect()}return t.prototype.getSymbolsByColor=function(t){if(null===this._service)return[];var n=this._service.store.getState(),e=Object(g.k)(n,t);return e?e.symbols:[]},t.prototype.getLists=function(){var t=this;return C.reduce((function(n,e){return n.set(e,new Set(t.getSymbolsByColor(e))),n}),new Map)},t.prototype.setSymbolsColor=function(t,n){var e=this;S.logNormal("Set symbols color "+n);try{t.forEach((function(t){e._setSymbolColor(t,n)}))}finally{this._onListChange()}},t.prototype.getSymbolColor=function(t){var n=this._symbols.get(t);return n?n.color:null},t.prototype.clearAllSymbolsColor=function(){S.logNormal("Clear all symbols color");var t=Array.from(this._symbols.keys());this.setSymbolsColor(t,null),
this._clearStore()},t.prototype.syncSymbols=function(){var t=this;return Promise.all([this._api.getColoredLists(),this._promise]).then((function(n){var e=n[0];return t._ensureConsistency(e)})).then((function(n){t._names={};for(var e=[],o=function(n){n.color&&n.title&&(t._names[n.color]=n.title),e.push.apply(e,n.symbols.map((function(t){return{name:t,color:n.color,serverColor:n.color}})))},r=0,l=n;r<l.length;r++){o(l[r])}var a=Object(i.ensureNotNull)(t._service),c=a.store,u=a.actions,h=n.filter((function(t){return 0===t.symbols.length})).map((function(t){return Object(s.__assign)(Object(s.__assign)({},t),{symbols:[]})}));c.dispatch(u.setSymbolLists(h)),S.logNormal("Sync symbols");var f=new Set(t._symbols.keys());e.forEach((function(n){var e=t._symbols.get(n.name)||null,o=e&&e.color!==n.color,r=null===e&&n.color;(o||r)&&t._onChange(n,e,!1),f.delete(n.name)})),f.forEach((function(n){var e=t._symbols.get(n);e&&null!==e.color&&t._onChange({name:n,color:null,serverColor:null},e,!1)})),t._onListChange(!0)})).catch((function(t){throw S.logError("Sync symbols error: "+t.message),t}))},t.prototype.flushChanges=function(){var t,n=this,e=this._getChangedSymbols();this._changed.clear(),t=e.length>0?this._handleSymbols(e):Promise.resolve([]);for(var o=0,r=Array.from(this._symbols.entries());o<r.length;o++){var s=r[o],i=s[0],l=s[1];this._symbols.set(i,{name:l.name,color:l.color,serverColor:l.color})}return t.then((function(t){return S.logNormal("Flush changes"),t})).catch((function(t){return S.logError("Flush changes error: "+t.message),Object(b.a)("marked-symbols"),n.syncSymbols(),[]}))},t.prototype.clear=function(){this._symbols.clear(),this._clearStore(),S.logNormal("Clear")},t.prototype.connect=function(){this._subscribeOnCrossTabEvent(),this._subscribeOnPushStream()},t.prototype.closeConnection=function(){this._unsubscribeOnCrossTabEvent(),this._unsubscribeOnPushStream()},t.prototype._ensureConsistency=function(t){var n=this;t=t.filter((function(t){return null!==t.color})).sort((function(t,n){return C.indexOf(Object(i.ensureNotNull)(t.color))-C.indexOf(Object(i.ensureNotNull)(n.color))}));for(var e=function(){for(var n=new Map,e=0,o=t;e<o.length;e++){var r=o[e],s=Object(i.ensureNotNull)(r.color);n.set(s,new Set(r.symbols))}return n}(),o=new Set,r=new Map,s=new Map,l=function(t,n){return t.has(n)||t.set(n,new Set),Object(i.ensureDefined)(t.get(n))},a=0,c=Array.from(e.entries());a<c.length;a++)for(var u=c[a],h=u[0],f=u[1],m=0,d=Array.from(f);m<d.length;m++){var y=d[m];o.has(y)&&(l(r,h).add(y),f.delete(y)),Object(_.l)(y)===y&&l(s,h).add(y),o.add(y)}for(var b=function(t,n,e){return e?{color:t,before:n,after:e.pro_name||n}:{color:t,before:n,after:n}},p=[],g=function(t,e){if(0===e.size)return"continue";S.logNormal("Marked consistency: resolving suspicious symbols in "+t+" list - "+Array.from(e)),p.push(Promise.all(Array.from(e).map((function(e){return n._session.snapshot(e).then((function(n){return b(t,e,n)})).catch((function(){return b(t,e)}))}))))},v=0,O=Array.from(s.entries());v<O.length;v++){var j=O[v];g(h=j[0],j[1])}
return Promise.all(p).then((function(s){for(var i=new Map,a=0,c=s;a<c.length;a++)for(var u=0,h=c[a];u<h.length;u++){var f=h[u];if(f.after!==f.before){var m=l(e,f.color);m.delete(f.before),l(r,f.color).add(f.before),o.has(f.after)||(o.add(f.after),m.add(f.after),l(i,f.color).add(f.after))}}0!==r.size&&S.logNormal("Marked consistency: removing symbols from "+r.size+" lists");for(var d=0,y=Array.from(r.entries());d<y.length;d++){var b=y[d],p=b[0],g=b[1];n._api.removeSymbols(p,Array.from(g))}0!==i.size&&S.logNormal("Marked consistency: appending resolved symbols to "+r.size+" lists");for(var _=0,v=Array.from(i.entries());_<v.length;_++){var C=v[_],O=(p=C[0],C[1]);n._api.addSymbols(p,Array.from(O))}for(var j=function(n,e){var o=t.find((function(t){return t.color===n}));o&&(o.symbols=Array.from(e))},w=0,L=Array.from(e.entries());w<L.length;w++){var N=L[w];j(p=N[0],g=N[1])}return t}))},t.prototype._handleSymbols=function(t){for(var n=new Map,e=new Map,o=function(t,n){return t.has(n)||t.set(n,new Set),Object(i.ensureDefined)(t.get(n))},r=0,s=t;r<s.length;r++){var l=s[r];if(l.color)o(n,l.color).add(l.name);else if(l.serverColor)o(e,l.serverColor).add(l.name)}for(var a=[],c=0,u=Array.from(n.entries());c<u.length;c++){var h=u[c],f=h[0],m=h[1];a.push(this._api.addSymbols(f,Array.from(m)))}for(var d=0,y=Array.from(e.entries());d<y.length;d++){var b=y[d];f=b[0],m=b[1];a.push(this._api.removeSymbols(f,Array.from(m)))}return Promise.all(a)},t.prototype._setSymbolColor=function(t,n){var e=this._symbols.get(t)||null,o={name:t,color:n,serverColor:e?e.serverColor:null};(e&&e.color!==o.color||!e&&o.color)&&this._onChange(o,e,!0)},t.prototype._onChange=function(t,n,e){void 0===n&&(n=null),void 0===e&&(e=!0),this._addSymbolToList(t.name,t.color,n&&n.color),this._collectDiffByColor(t.name,t.color,n&&n.color),this._symbols.set(t.name,t),e&&this._changed.add(t.name),this._opts.onSymbolChange&&this._opts.onSymbolChange({name:t.name,color:t.color},n?{name:n.name,color:n.color}:null)},t.prototype._onListChange=function(t){void 0===t&&(t=!1),this._diff.size&&(this._opts.onListChange&&this._opts.onListChange(this._diff),t||f.TVXWindowEvents.emit("ListChanged",JSON.stringify(this._getChangedSymbols())),this._diff.clear())},t.prototype._addSymbolToList=function(t,n,e){if(null!==this._service){var o=this._service,r=o.store,i=o.actions;if(n){if((a=new Set(this.getSymbolsByColor(n))).has(t))return;if(500===a.size)throw S.logNormal("LimitReached"),new Error("LimitReached");a.add(t);var l=this._ensureColoredList(n);r.dispatch(i.addOrUpdateSymbolList(Object(s.__assign)(Object(s.__assign)({},l),{symbols:Array.from(a)})))}if(e){var a;(a=new Set(this.getSymbolsByColor(e))).delete(t);l=this._ensureColoredList(e);r.dispatch(i.addOrUpdateSymbolList(Object(s.__assign)(Object(s.__assign)({},l),{symbols:Array.from(a)})))}}},t.prototype._ensureColoredList=function(t){var n=Object(i.ensureNotNull)(this._service).store.getState();return Object(g.k)(n,t)||Object(_.c)(t,this._names[t])},t.prototype._collectDiffByColor=function(t,n,e){if(n!==e){var o,r
;if(n)if(o=this._diff.get(n))o.set(t,1);else(r=new Map).set(t,1),this._diff.set(n,r);if(e)if(o=this._diff.get(e))o.set(t,-1);else(r=new Map).set(t,-1),this._diff.set(e,r)}},t.prototype._getChangedSymbols=function(){var t=this,n=[];return this._changed.forEach((function(e){var o=t._symbols.get(e);o&&n.push(o)})),n},t.prototype._clearStore=function(){if(null!==this._service){var t=this._service,n=t.store,e=t.actions,o=n.getState(),r=C.map((function(t){return Object(g.k)(o,t)})).filter((function(t){return Boolean(t)})).map((function(t){return Object(s.__assign)(Object(s.__assign)({},t),{symbols:[]})}));n.dispatch(e.setSymbolLists(r))}},t.prototype._subscribeOnCrossTabEvent=function(){f.TVXWindowEvents.on("ListChanged",this._onCrossTabChange)},t.prototype._unsubscribeOnCrossTabEvent=function(){f.TVXWindowEvents.off("ListChanged",this._onCrossTabChange)},t.prototype._subscribeOnPushStream=function(){d.a.on("marked-symbols",this._onPushStreamChange),d.a.onPrivateStatus(this._onPushStreamStatus)},t.prototype._unsubscribeOnPushStream=function(){d.a.off("marked-symbols",this._onPushStreamChange),d.a.offStatus(this._onPushStreamStatus),clearTimeout(o),O=null},t}(),w=e("JOqt"),L=e("brCa");e.d(n,"a",(function(){return E}));var N=function(){function t(t){var n=this;this._symbolChangeHandlers=new Map,this._listChangeHandlers=[],this._initHandlers=[],this._sync=null,this._inited=!1,this._broadcastOnSymbolChange=function(t,e){var o=n._symbolChangeHandlers.get(t.name);o&&o.forEach((function(n){return n(t,e)}))},this._broadcastOnListChange=function(t){n._listChangeHandlers.forEach((function(n){return n(t)}))},this._flushModelChanges=function(){n._model.flushChanges()},this._onLoginStateChange=function(){var t;n._model.closeConnection(),window.is_authenticated?(n._model.connect(),t=n._syncSymbols()):(n._model.clear(),n._inited=!1,t=Promise.resolve()),t.then(n._fireInit)},this._fireInit=function(){n._initHandlers.forEach((function(t){return t()}))},this._runWithSync=function(t){n._sync?n._sync.then(t):t()},this._model=new j({api:t?t.api:void 0,quoteSession:t?t.quoteSession:void 0,onSymbolChange:this._broadcastOnSymbolChange,onListChange:this._broadcastOnListChange}),this._subscribeLoginStateChange(),this._flushModelChanges=Object(w.debounce)(this._flushModelChanges,2e3),this._syncSymbols().then(this._fireInit)}return t.prototype.getSymbolsByColor=function(t){return this._model.getSymbolsByColor(t)},t.prototype.setSymbolsColor=function(t,n){var e=this;0!==t.length&&this._runWithSync((function(){try{e._model.setSymbolsColor(t,n),e._flushModelChanges()}catch(s){"LimitReached"===s.message&&(e._flushModelChanges(),A||(A=Object(L.createNoticeDialog)({title:T,content:(o=500,r.t("Unable to flag all selected symbols since it exceeds the maximum amount ({0}).").format(o))})).then((function(t){t.on("afterClose",(function(){A=null})),t.open()})))}var o}))},t.prototype.getSymbolColor=function(t){return this._model.getSymbolColor(t)},t.prototype.clearAllSymbolsColor=function(){var t=this;this._runWithSync((function(){t._model.clearAllSymbolsColor(),
t._flushModelChanges()}))},t.prototype.mergeSymbolsByColor=function(t,n){var e=this._model.getSymbolsByColor(t),o=e.filter((function(t){return!n.includes(t)})),r=n.filter((function(t){return!e.includes(t)}));this.setSymbolsColor(o,null),this.setSymbolsColor(r,t)},t.prototype.onSymbolChange=function(t,n){var e=this._symbolChangeHandlers.get(t);e?e.push(n):this._symbolChangeHandlers.set(t,[n])},t.prototype.offSymbolChange=function(t,n){var e=this._symbolChangeHandlers.get(t);if(e){var o=e.filter((function(t){return t!==n}));o.length>0?this._symbolChangeHandlers.set(t,o):this._symbolChangeHandlers.delete(t)}},t.prototype.onListChange=function(t){this._listChangeHandlers.push(t)},t.prototype.offListChange=function(t){this._listChangeHandlers=this._listChangeHandlers.filter((function(n){return n!==t}))},t.prototype.onInit=function(t){this._initHandlers.push(t)},t.prototype.offInit=function(t){this._initHandlers=this._initHandlers.filter((function(n){return n!==t}))},t.prototype.destroy=function(){this._model.clear(),this._model.closeConnection(),this._unsubscribeLoginStateChange()},t.prototype.isInited=function(){return this._inited},t.prototype._subscribeLoginStateChange=function(){window.loginStateChange&&window.loginStateChange.subscribe(this,this._onLoginStateChange)},t.prototype._unsubscribeLoginStateChange=function(){window.loginStateChange&&window.loginStateChange.unsubscribe(this,this._onLoginStateChange)},t.prototype._syncSymbols=function(){var t=this;if(window.is_authenticated){this._sync=this._model.syncSymbols();var n=function(){t._sync=null,t._inited=!0};return this._sync.then(n).catch(n)}return Promise.resolve()},t}(),T=r.t("Issue With Flagging"),A=null;var P=null;function E(){return null===P&&(P=new N),P}}}]);